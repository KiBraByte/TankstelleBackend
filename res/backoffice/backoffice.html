<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>BackOffice</title>
    <link rel="stylesheet" href="/backoffice/css/backoffice.css">
</head>
<body>
<h1>BackOffice</h1>

<div id="linkContainer">
    <button class="styled-link" onclick="showForm('formKundeAnlegen')">Kunde Anlegen</button>
    <button class="styled-link" onclick="showForm('formTankkarte')">Tankkarte Anlegen</button>
    <button class="styled-link" onclick="showForm('formAbrechnung')">Abrechnung</button>
    <!-- Add more buttons here for additional forms -->
</div>

<div id="formKundeAnlegen" class="formContainer" style="display:none;">
    <h2>Kunde Anlegen</h2>
    <form id="kundeAnlegenForm">
        <label for="firmenname">Firmenname</label>
        <br>
        <input type="text" id="firmenname" name="firmenname" required>
        <br>
        <label for="UserAccount">UserAccount</label>
        <br>
        <input type="text" id="UserAccount" name="UserAccount" required>
        <br>
        <label for="password">Password</label>
        <br>
        <input type="text" id="password" name="password" required>
        <br>
        <label for="status">Status</label>
        <br>
        <input type="text" id="status" name="status">
        <br>
        <label for="kundenlimit">Kundenlimit</label>
        <br>
        <input type="text" id="kundenlimit" name="kundenlimit">
        <br>
        <button type="button" class="styled-link" onclick="submitKundeAnlegen()">Anlegen</button>
    </form>
    <div id="kundeAnlegenOutput"></div>
</div>


<div id="formTankkarte" class="formContainer" style="display:none;">
    <h2>Tankkarte</h2>
    <form id="tankkartenForm">
        <label for="kundenNr">KNr:</label>
        <br>
        <input type="text" id="kundenNr" name="kundenNr" required>
        <br>
        <label for="jahreGueltig">Jahre Gueltig:</label>
        <br>
        <input type="number" id="jahreGueltig" name="jahreGueltig">
        <br>
        <label for="limit">Limit Euro:</label>
        <br>
        <input type="number" id="limit" name="limit">
        <br>
        <label for="anzahlKarten">Anzahl Karten:</label>
        <br>
        <input type="number" id="anzahlKarten" name="anzahlKarten">
        <br>
        <button type="button" class="styled-link" onclick="submitTankkarte()">Anlegen</button>
    </form>
    <div id="tankkartenOutput"></div>
</div>

<div id="formAbrechnung" class="formContainer" style="display:none;">
    <h2>Abrechnung</h2>
    <form id="abrechnungForm">
        <label for="begindatum">Beginndatum</label>
        <br>
        <input type="date" id="begindatum" name="begindatum">
        <br>
        <label for="enddatum">Enddatum</label>
        <br>
        <input type="date" id="enddatum" name="enddatum">
        <br>
        <button type="button" class="styled-link" onclick="submitAbrechnung()">Abrufen</button>
    </form>
    <div id="abrechnungOutput"></div>
</div>

<script>
    function showForm(formId) {
        // Hide all forms
        document.querySelectorAll('.formContainer').forEach(form => {
            form.style.display = 'none';
        });
        // Show the selected form
        document.getElementById(formId).style.display = 'block';
    }

    function submitKundeAnlegen() {
        const myHeaders = new Headers();
        myHeaders.append("Content-Type", "application/x-www-form-urlencoded");

        const urlencoded = new URLSearchParams();
        urlencoded.append("firmenname", document.getElementById("firmenname").value);
        urlencoded.append("status", document.getElementById("status").value);
        urlencoded.append("kundenlimit", document.getElementById("kundenlimit").value);
        urlencoded.append("userName", document.getElementById("UserAccount").value);
        urlencoded.append("password", document.getElementById("password").value);
        urlencoded.append("sessionID", localStorage.getItem("sessionID") || "0");

        const requestOptions = {
            method: "POST",
            headers: myHeaders,
            body: urlencoded,
            redirect: "follow"
        };

        fetch("/api/kundeanlegen", requestOptions)
            .then((response) => response.json())
            .then((result) => {
                const output = `<p>Kunden-Nummer: ${result.kundenNr}</p>`;
                document.getElementById("kundeAnlegenOutput").innerHTML = output;
            })
            .catch((error) => {
                document.getElementById("kundeAnlegenOutput").innerText = "Fehler: " + error;
            });
    }

    function submitAbrechnung() {
        const myHeaders = new Headers();
        myHeaders.append("Content-Type", "application/x-www-form-urlencoded");

        const urlencoded = new URLSearchParams();
        urlencoded.append("begindatum", document.getElementById("begindatum").value);
        urlencoded.append("enddatum", document.getElementById("enddatum").value);
        urlencoded.append("sessionID", localStorage.getItem("sessionID") || "0");

        const requestOptions = {
            method: "POST",
            headers: myHeaders,
            body: urlencoded,
            redirect: "follow"
        };

        fetch("/api/abrechnung", requestOptions)
            .then((response) => response.json())
            .then((result) => {
                const output = `
                <p>Abrechnungs-Nummer: ${result.insertedAbrechnung}</p>
                <p>Mitteilung: ${result.msg}</p>
            `;
                document.getElementById("abrechnungOutput").innerHTML = output;
            })
            .catch((error) => {
                document.getElementById("abrechnungOutput").innerText = "Fehler: " + error;
            });
    }

    function submitTankkarte() {
        const myHeaders = new Headers();
        myHeaders.append("Content-Type", "application/x-www-form-urlencoded");

        const urlencoded = new URLSearchParams();
        urlencoded.append("kundenNr", document.getElementById("kundenNr").value);
        urlencoded.append("jahreGueltig", document.getElementById("jahreGueltig").value);
        urlencoded.append("limit", document.getElementById("limit").value);
        urlencoded.append("anzahlKarten", document.getElementById("anzahlKarten").value);
        urlencoded.append("sessionID", localStorage.getItem("sessionID") || "0");

        const requestOptions = {
            method: "POST",
            headers: myHeaders,
            body: urlencoded,
            redirect: "follow"
        };

        fetch("/api/tankkarteanlegen", requestOptions)
            .then((response) => response.json()
                .then((result) => {
                    if (response.ok) {
                        for (let pan of result.msg) {
                            const currEl = document.createElement("p");
                            currEl.innerText = pan;
                            document.getElementById("tankkartenOutput").appendChild(currEl);
                        }
                    } else {
                        document.getElementById("tankkartenOutput").innerText = result.error;
                    }
            }))
            .catch((error) => {
                document.getElementById("tankkartenOutput").innerText = "Fehler: " + error;
            });
    }


    // Add more submit functions here for additional forms
</script>
</body>
</html>