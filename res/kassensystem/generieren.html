<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Tankung Generator</title>
    <link rel="stylesheet" href="../main/style.css">
    <style>
        body { font-family: Arial, sans-serif; }
        .tankung {
            margin: 20px 0;
            padding: 10px;
            display: inline-block;
            width: 100px;
            vertical-align: top;
            text-align: center;
        }

        #tankungen {
            display: flex;
            flex-wrap: wrap;
        }
    </style>
</head>
<body>
<h1>Tankung Generator</h1>
<button class="styled-link" id="generateButton">Tankung generieren</button>

<button class="styled-link" id="proceedButton" style="display: none;">Zur PAN-Eingabe</button>
<div id="tankungen"></div>

<script>
    let count = 0;
    document.getElementById('generateButton').addEventListener('click', function() {
        const productElement = document.createElement("div");
        productElement.innerText = "Diesel";
        productElement.id = `product${count}`;

        const costElement = document.createElement("div");
        costElement.innerText = (Math.random() * (1.5 - 1) + 1).toFixed(2);
        costElement.id = `cost${count}`;

        const literElement = document.createElement("div");
        literElement.innerText = (Math.random() * (50 - 5) + 5).toFixed(2);
        literElement.id = `liter${count}`;

        const payButton = document.createElement("button");
        payButton.innerText = "PAY";
        payButton.id = `${count}`;

        const tankungDiv = document.createElement("div");
        tankungDiv.className = 'tankung';
        tankungDiv.append(productElement, costElement, literElement, payButton);

        document.getElementById("tankungen").appendChild(tankungDiv);

        payButton.addEventListener("click", async function(event) {
            const id = event.target.id;
            const p = document.getElementById(`product${id}`).innerText;
            const c = document.getElementById(`cost${id}`).innerText;
            const l = document.getElementById(`liter${id}`).innerText;

            const urlencoded = new URLSearchParams();
            urlencoded.append("produkt", p);
            urlencoded.append("kosten", c);
            urlencoded.append("liter", l);

            let data = await fetch("/kassensystem/zahlen", {
                method: "POST",
                body: urlencoded
            });

            document.open();
            document.write(await data.text());
            document.close();
        });

        count++;
    });
</script>
</body>
</html>
