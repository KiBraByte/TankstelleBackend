<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PAN Eingabe</title>
    <link rel="stylesheet" href="/main/css/style.css">
</head>
<body>
<h1>PAN Eingabe</h1>
<div>Product: <span id="product"><{}></span></div>
<div>Cost: <span id="cost"><{}></span></div>
<div>Liter: <span id="liter"><{}></span></div>

<label for="PAN">PAN des Kunden:</label>
<input type="text" id="pan" name="pan" required>
<button class="styled-link" id="pay">Bezahlen</button>

<div id="response" style="margin-top: 20px; color: green;"></div>

<script>
    document.getElementById("pay").addEventListener("click", function(event) {
        let p = document.getElementById("product").innerText;
        let c = document.getElementById("cost").innerText;
        let l = document.getElementById("liter").innerText;
        let pan = document.getElementById("pan").value;
        let responseDiv = document.getElementById("response");

        const urlencoded = new URLSearchParams();
        urlencoded.append("produkt", p);
        urlencoded.append("preisproeinheit", c);
        urlencoded.append("menge", l);
        urlencoded.append("pan", pan);
        urlencoded.append("tsnr", "40100");
        urlencoded.append("sessionID", localStorage.getItem("sessionID") || 0);

        fetch("/api/tankunganlegen", {
            method: "POST",
            body: urlencoded,
            redirect: "follow"
        })
            .then((res) => {
                res.json().then((json) => {
                    console.log(json);
                    if (res.ok) {
                        responseDiv.innerText = json.msg;
                        responseDiv.style.color = 'green';
                    } else {
                        responseDiv.innerText = json.error;
                        responseDiv.style.color = 'red';
                    }
                })
            })
            .catch((err) => {
                console.log(err);
                responseDiv.innerText = "Error: " + err.message;
                responseDiv.style.color = 'red';
            });
    })
</script>
</body>
</html>
