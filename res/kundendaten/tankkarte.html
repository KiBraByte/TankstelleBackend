<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>KundenPortal</title>
    <link rel="stylesheet" href="/kundendaten/css/tankkarte.css">
</head>
<body>
<h1>Kunden Portal</h1>
<form method="post">
    <label for="kID">Kunden-Nummer</label>
    <br>
    <input type="text" id="kID" name="kID" value="1">
    <br>
</form>
<button id="button">Anzeigen</button>
<div id="dataContainer">

</div>

<script>

    const dataContainer = document.getElementById("dataContainer");
    function clearElement(element) {
        while(element.firstChild) {
            element.removeChild(element.firstChild);
        }
    }

    function appendError(element, err) {
        clearElement(document.getElementById("dataContainer"));
        let errElement = document.createElement("p");
        errElement.innerText = err;

        document.getElementById("dataContainer").append(errElement);
    }

    document.getElementById('button').addEventListener('click', function() {

        fetch(`/api/kundendaten/${localStorage.getItem("sessionID") || "0"}/${document.getElementById("kID").value}`, { method: "GET" })
            .then((response) => {
                if (response.ok) {
                    response.json().then(j => {
                        clearElement(document.getElementById("dataContainer"));

                        let firmenName = document.createElement("p");
                        firmenName.innerText = "Firma: " + j.firmenName;

                        let limit = document.createElement("p");
                        limit.innerText = "Limit in Liter: " + j.kundenLimit;

                        let getankt = document.createElement("p");
                        getankt.innerText = "Liter getankt: " + j.getankt;

                        let produkte = document.createElement("p");
                        produkte.innerText = "Produkte: " + j.produkte;

                        dataContainer.append(firmenName, limit, getankt, produkte);
                    }).catch((error) => {
                        appendError(dataContainer, error);
                    })
                } else {
                    appendError(dataContainer, response.statusText)
                }
            });
    });
</script>
</body>
</html>